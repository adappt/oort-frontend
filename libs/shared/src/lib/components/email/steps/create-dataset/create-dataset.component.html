<form class="p-4" [formGroup]="dataSetFiltersFormGroup" (ngSubmit)="onSubmit()">
  <div class="text-left">
    <div class="mt-4">
      <label htmlFor="exampleSelect" class="block text-gray-700 text-sm">
        {{ 'common.title' | translate }}*
      </label>
      <input id="block_title" type="text" [placeholder]="'common.title' | translate" formControlName="name"
        [(ngModel)]="activeTab.title"
        class="mt-1 block w-1/3 py-2 px-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" />
    </div>
    <div class="tab-container">
    <!-- Block Tabs -->
    <kendo-tabstrip (tabSelect)="changeTab($event)">
      <kendo-tabstrip-tab *ngFor="let tab of tabs; let i = index"
        [title]="tab.title"
        [selected]="tab.active">
        <ng-template kendoTabTitle>
          <div class="flex justify-between items-center">
            <span>{{tab.title}}</span>
            <button (click)="deleteTab(i, $event)"><ui-icon icon="delete" variant="danger"></ui-icon></button>
          </div>
        </ng-template>
        <ng-template kendoTabContent>
          <!-- Dataset Select -->
          <div class="mt-6 flex gap-4">
            <div class="w-1/2">
              <label htmlFor="exampleSelect" class="block text-gray-700 text-sm">
                {{ 'components.queryBuilder.dataset.title' | translate }}*
              </label>
              <ng-select id="exampleSelect" name="exampleSelect"  [ngModelOptions]="{ standalone: true }"
                #select
                [items]="cachedElements"
                bindLabel="name"
                [searchable]="true"
                bindValue="id"
                [(ngModel)]="selectedResourceId"
                [virtualScroll]="true"
                appendTo="body"
                (scrollToEnd)="getResourceDataOnScroll($event)"
                (change)="getResourceData()"
                placeholder="{{ 'components.queryBuilder.dataset.select' | translate }}">
                <ng-template disabled selected>
                  <span></span>
                </ng-template>
                <ng-template ng-option-tmp let-item="item" let-index="index" let-search="searchTerm">
                  <span>{{ replaceUnderscores(item.name || "") | titlecase }}</span>
                </ng-template>
              </ng-select>
            </div>
            <div class="w-1/2">
              <label htmlFor="exampleSelect" class="block text-gray-700 text-sm">
                {{ 'components.queryBuilder.block.label' | translate }}*
              </label>
              <button type="button"
                class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 font-bold">
                {{ tab.title }}
              </button>
            </div>
          </div>
          <kendo-tabstrip>
            <!-- Filter Tab -->
            <kendo-tabstrip-tab>
              <ng-template kendoTabTitle>
                {{ 'components.queryBuilder.filter.title' | translate }}
              </ng-template>
              <ng-template kendoTabContent>
                <ng-container *ngIf="resource?.fields?.length">
                  <div formGroupName="query" class="flex-row gap-4 mt-6">
                    <div class="flex gap-4">
                      <div class="mt-2">
                        <label htmlFor="data_set_limit" class="block text-gray-700 text-sm">
                          Table Row {{ 'components.queryBuilder.sort.limit' | translate | titlecase }}
                        </label>
                        <input id="data_set_limit"
                          class="mt-1 block w-32 py-1 px-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                          type="number" min="0" [placeholder]="'components.queryBuilder.sort.limit' | translate" formControlName="pageSize">
                      </div>
                      <div formGroupName="filter" class="mt-2">
                        <label htmlFor="exampleSelect" class="block text-gray-700 text-sm">
                          {{ 'components.queryBuilder.filter.logic' | translate }}
                        </label>
                        <select id="exampleSelect" name="exampleSelect" formControlName="logic"
                          class="mt-1 block w-32 py-1 px-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                          <option value="and">
                            {{ 'components.queryBuilder.filter.and' | translate }}
                          </option>
                          <option value="or">
                            {{ 'components.queryBuilder.filter.or' | translate }}
                          </option>
                        </select>
                      </div>
                    </div>
                    <div class="flex gap-4">
                      <button type="button"
                        class="mt-1 block w-32 py-1 px-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                        (click)="addNewDatasetFilter()">
                        {{ 'components.queryBuilder.filter.new' | translate }}
                      </button>
                      <button type="button"
                        class="mt-1 block w-32 py-1 px-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        {{ 'components.queryBuilder.filter.newGroup' | translate }}
                      </button>
                    </div>
                  </div>
                  <!-- <form [formGroup]="dataSetFiltersFormGroup" (ngSubmit)="onSubmit()"> -->
                  <div formGroupName="query">
                    <div formGroupName="filter">
                      <div formArrayName="filters">
                        <div *ngFor="let data of filterFields.controls; let fieldIndex = index">
                          <div class="flex gap-5 ml-20" [formGroupName]="fieldIndex">
                            <div class="mt-4 w-1/3">
                              <label htmlFor="exampleSelect" class="block text-gray-700 text-sm">
                                {{ 'components.queryBuilder.filter.field' | translate }}
                              </label>
                              <select id="exampleSelect" name="exampleSelect" (change)="setField($event)"
                                class="mt-1 block w-full py-2 px-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                formControlName="field">
                                <ng-container *ngFor="let fieldDetails of resource?.fields">
                                  <option [value]="fieldDetails?.name">
                                    {{ replaceUnderscores(fieldDetails?.name) | titlecase }}
                                  </option>
                                </ng-container>
                              </select>
                            </div>
                            <div class="mt-4 w-1/3">
                              <label htmlFor="exampleSelect" class="block text-gray-700 text-sm">
                                {{ 'components.queryBuilder.filter.operator' | translate }}
                              </label>
                              <select id="exampleSelect" name="exampleSelect"
                                class="mt-1 block w-full py-2 px-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                formControlName="operator">
                                <option [value]="operator?.value" *ngFor="let operator of operators">
                                  {{ operator.label | translate | titlecase }}
                                </option>
                              </select>
                            </div>
                            <div class="mt-4 w-1/3">
                              <label htmlFor="exampleSelect" class="block text-gray-700 text-sm">
                                {{ 'components.queryBuilder.filter.value' | translate }}
                              </label>
                              <input
                                class="mt-1 block w-full py-2 px-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                placeholder="Enter the value" formControlName="value" />
                            </div>
                            <button class="ui-button-icon primary medium button-danger"
                              (click)="deleteDatasetFilter(fieldIndex)">
                              <ui-icon icon="delete" variant="danger">
                              </ui-icon>
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </ng-container>
              </ng-template>
            </kendo-tabstrip-tab>
            <!-- Fields Tab -->
            <kendo-tabstrip-tab>
              <ng-template kendoTabTitle>
                {{ 'components.queryBuilder.fields.title' | translate }}
              </ng-template>
              <ng-template kendoTabContent>
                <ng-container>
                  <div class="flex gap-4 mt-4">
                    <!-- Available Fields -->
                    <div class="mt-4 w-1/2">
                      <label htmlFor="exampleSelect" class="block text-gray-700 text-sm">
                        {{ 'components.queryBuilder.fields.available' | translate }}
                      </label>
                      <div class="mt-1 text-sm text-left block w-full py-1 px-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                        <div class="mt-4">
                          <input id="searchBar" type="text" [(ngModel)]="searchQuery"
                            placeholder="Search" class="mt-1 block w-full py-1 px-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <ng-container *ngFor="let fieldDetails of resource?.fields">
                          <div *ngIf="fieldDetails?.name.includes(searchQuery)" (click)="addSelectiveFields(fieldDetails?.name)"
                            class="group mt-1 text-sm text-left block w-full py-1 px-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 hover:bg-gray-200 cursor-pointer flex justify-between items-center">
                            {{ replaceUnderscores(fieldDetails?.name) | titlecase }}
                            <div class="hidden group-hover:block">
                              <ui-icon icon="arrow_right" variant="grey"></ui-icon>
                            </div>
                          </div>
                        </ng-container>
                      </div>
                    </div>

                    <!-- Selected Fields -->
                    <div class="mt-4 w-1/2">
                      <label htmlFor="exampleSelect" class="block text-gray-700 text-sm">
                       {{ 'components.queryBuilder.fields.selected' | translate }}
                      </label>
                      <div class="mt-1 text-sm text-left block w-full py-1 px-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                       <div class="mt-4">
                         <input id="searchBarSelected" type="text"
                           placeholder="Search" class="mt-1 block w-full py-1 px-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                       </div>
                       <ng-container *ngFor="let fields of selectedFields">
                        <div (click)="removeSelectiveFields(fields.name)"
                          class="group mt-1 text-sm text-left block w-full py-1 px-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 hover:bg-gray-200 cursor-pointer flex justify-between items-center">
                          <div class="hidden group-hover:block">
                            <ui-icon icon="arrow_left" variant="grey"></ui-icon>
                          </div>
                          {{ replaceUnderscores(fields.name) | titlecase }}
                        </div>
                      </ng-container>
                      </div>
                    </div>
                  </div>
                </ng-container>
              </ng-template>
            </kendo-tabstrip-tab>
            <!-- Style Tab -->
            <kendo-tabstrip-tab [disabled]="true">
              <ng-template kendoTabTitle>
                {{ 'components.queryBuilder.style.title' | translate }}
              </ng-template>
              <ng-template kendoTabContent>
                <ng-container>
                  <div>
                    <div class="block mt-8 text-gray-700 font-bold text-xs">Block Style</div>
                    <div>
                      <div class="h-14 w-full bg-blue-50">
                        <div class="mt-3 flex gap-3">
                          <div class="mt-1">
                            <label htmlFor="exampleSelect" class="block text-gray-700 mt-1 text-xs">
                              Font Size
                            </label>
                            <button type="button"
                              class="mt-1 text-xs text-left block w-24 py-1 px-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                              16px
                            </button>
                          </div>
                          <div class="mt-1">
                            <label htmlFor="exampleSelect" class="block text-gray-700 mt-1 text-xs">
                              Background Color
                            </label>
                            <button type="button"
                              class="mt-1 text-xs text-left block w-24 py-1 px-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                              16px
                            </button>
                          </div>
                          <div class="mt-1">
                            <label htmlFor="exampleSelect" class="block text-gray-700 mt-1 text-xs">
                              Text Color
                            </label>
                            <button type="button"
                              class="mt-1 text-xs text-left block w-24 py-1 px-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                              16px
                            </button>
                          </div>

                          <div class="mt-1">
                            <label htmlFor="exampleSelect" class="block text-gray-700 mt-1 text-xs">
                              Text Style
                            </label>
                            <div class="flex gap-3">
                              <button type="button"
                                class="mt-1 text-xs text-left block w-8 py-1 px-2 border border-gray-300 bg-white font-bold unded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                B
                              </button>

                              <button type="button"
                                class="mt-1 text-xs text-left block w-8 py-1 px-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                I
                              </button>

                              <button type="button"
                                class="mt-1 text-xs text-left block w-8 py-1 px-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none underline ocus:ring-indigo-500 focus:border-indigo-500">
                                U
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="flex gap-3">
                    <div class="mt-4">
                      <label htmlFor="exampleSelect" class="block text-gray-700 text-sm">
                        Title*
                      </label>
                      <button type="button"
                        class="mt-1 text-xs text-left block w-52 py-1 px-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                        Title
                      </button>
                    </div>
                    <div>
                      <button type="button"
                        class="mt-9 text-xs text-left block w-24 py-1 px-2 text-white order border-gray-300 bg-blue-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                        Add Feild
                      </button>
                    </div>
                  </div>

                  <div class="h-14 w-full bg-gray-50">
                    <div class="mt-4 flex gap-3">
                      <div class="mt-1">
                        <label htmlFor="exampleSelect" class="block text-gray-700 mt-1 text-xs">
                          Select Feild
                        </label>
                        <button type="button"
                          class="mt-1 text-xs text-left block w-48 py-1 px-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                          Single Id
                        </button>
                      </div>
                      <div class="mt-1">
                        <label htmlFor="exampleSelect" class="block text-gray-700 mt-1 text-xs">
                          Font Size
                        </label>
                        <button type="button"
                          class="mt-1 text-xs text-left block w-24 py-1 px-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                          16px
                        </button>
                      </div>
                      <div class="mt-1">
                        <label htmlFor="exampleSelect" class="block text-gray-700 mt-1 text-xs">
                          Background Color
                        </label>
                        <button type="button"
                          class="mt-1 text-xs text-left block w-24 py-1 px-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                          16px
                        </button>
                      </div>
                      <div class="mt-1">
                        <label htmlFor="exampleSelect" class="block text-gray-700 mt-1 text-xs">
                          Text Color
                        </label>
                        <button type="button"
                          class="mt-1 text-xs text-left block w-24 py-1 px-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                          16px
                        </button>
                      </div>

                      <div class="mt-1">
                        <label htmlFor="exampleSelect" class="block text-gray-700 mt-1 text-xs">
                          Text Style
                        </label>
                        <div class="flex gap-3">
                          <button type="button"
                            class="mt-1 text-xs text-left block w-8 py-1 px-2 border border-gray-300 bg-white font-bold unded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            B
                          </button>

                          <button type="button"
                            class="mt-1 text-xs text-left block w-8 py-1 px-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            I
                          </button>

                          <button type="button"
                            class="mt-1 text-xs text-left block w-8 py-1 px-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none underline ocus:ring-indigo-500 focus:border-indigo-500">
                            U
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="h-14 w-full bg-gray-50">
                    <div class="mt-4 flex gap-3">
                      <div class="mt-1">
                        <label htmlFor="exampleSelect" class="block text-gray-700 mt-1 text-xs">
                          Select Feild
                        </label>
                        <button type="button"
                          class="mt-1 text-xs text-left block w-48 py-1 px-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                          Single Id
                        </button>
                      </div>
                      <div class="mt-1">
                        <label htmlFor="exampleSelect" class="block text-gray-700 mt-1 text-xs">
                          Font Size
                        </label>
                        <button type="button"
                          class="mt-1 text-xs text-left block w-24 py-1 px-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                          16px
                        </button>
                      </div>
                      <div class="mt-1">
                        <label htmlFor="exampleSelect" class="block text-gray-700 mt-1 text-xs">
                          Background Color
                        </label>
                        <button type="button"
                          class="mt-1 text-xs text-left block w-24 py-1 px-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                          16px
                        </button>
                      </div>
                      <div class="mt-1">
                        <label htmlFor="exampleSelect" class="block text-gray-700 mt-1 text-xs">
                          Text Color
                        </label>
                        <button type="button"
                          class="mt-1 text-xs text-left block w-24 py-1 px-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                          16px
                        </button>
                      </div>
                      <div class="mt-1">
                        <label htmlFor="exampleSelect" class="block text-gray-700 mt-1 text-xs">
                          Text Style
                        </label>
                        <div class="flex gap-3">
                          <button type="button"
                            class="mt-1 text-xs text-left block w-8 py-1 px-2 border border-gray-300 bg-white font-bold unded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            B
                          </button>

                          <button type="button"
                            class="mt-1 text-xs text-left block w-8 py-1 px-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            I
                          </button>

                          <button type="button"
                            class="mt-1 text-xs text-left block w-8 py-1 px-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none underline ocus:ring-indigo-500 focus:border-indigo-500">
                            U
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </ng-container>
              </ng-template>
            </kendo-tabstrip-tab>
            <!-- Preview Tab -->
            <kendo-tabstrip-tab>
              <ng-template kendoTabTitle>
                {{ 'common.preview' | translate }}
              </ng-template>
              <ng-template kendoTabContent>
                <table id="tblPreview" *ngIf="dataList?.length" class="w-full border border-blue-600 shadow-xs m-1">
                  <thead class="bg-blue-600  border-blue-600 shadow-xs text-white">
                    <tr class="bg-blue-600  border-blue-600 shadow-xs text-white">
                      <ng-container *ngFor="let item of dataList[0] | keyvalue">
                        <th class="bg-blue-600  border-white-600 shadow-xs text-white p-2  text-center">{{
                          replaceUnderscores(item.key) | titlecase }}</th>
                      </ng-container>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let data of dataList" class=" bg-white-600 border-blue-600 text-blue-600">
                      <ng-container *ngFor="let item of data | keyvalue">
                        <td class="p-2 border border-blue-600 shadow-xs m-1 text-center">{{ item.value }}</td>
                      </ng-container>
                    </tr>
                  </tbody>
                </table>
              </ng-template>
            </kendo-tabstrip-tab>
          </kendo-tabstrip>
          <button *ngIf="filterFields.controls" type="submit"
            class="text-white float-right block mt-2 w-32 rounded-md border border-blue-600 bg-blue-600 shadow-xs m-1">
            {{ 'components.queryBuilder.apply' | translate }}</button>
        </ng-template>
      </kendo-tabstrip-tab>
    </kendo-tabstrip>
    <button class="add-tab-button" (click)="addTab()">
      <ui-icon icon="add" variant="primary"></ui-icon>
    </button>
  </div>
</div>
</form>
